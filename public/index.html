<!DOCTYPE html>
<html lang="en">
<head>

  <meta name="description" content="Practice real conversations with IZZY, the AI avatar coach.">
  <meta property="og:title"       content="IZZY – AI Avatar for Real Conversations">
  <meta property="og:description" content="Practice real conversations with IZZY, the AI avatar coach.">
  <meta property="og:url" content="https://izzy-auth.web.app">  <meta property="og:type"        content="website">
  <meta property="og:image" content="https://izzy-auth.web.app/img/og.png">
  <meta property="og:image:alt"   content="Screenshot of IZZY AI avatar app">


  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IZZY – AI Avatar for Real Conversations</title>
  <script src="https://www.google.com/recaptcha/api.js?onload=onRecaptchaLoad&render=explicit" async defer></script>
  <link rel="stylesheet" href="output.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />


  <style>
    /* Basic Reset & Font */
    * { box-sizing: border-box; margin: 0; padding: 0; scroll-behavior: smooth; } /* Added smooth scroll */
    body { font-family: 'Inter', sans-serif; background: #fff; color:#333; }

    /* Backdrop-blur card effect */
    .glass {
      background: rgba(255,255,255,0.85); /* Semi-transparent white */
      backdrop-filter: blur(10px); /* Blur effect */
      -webkit-backdrop-filter: blur(10px); /* Safari support */
      border-radius: 1rem; /* Rounded corners */
      padding: 2rem; /* Padding */
      box-shadow: 0 20px 25px rgba(0,0,0,0.05); /* Subtle shadow */
      border: 1px solid rgba(255, 255, 255, 0.2); /* Optional subtle border */
    }

    /* Blur background behind modals */
    .blur-background { filter: blur(8px); pointer-events:none; }

    /* Simple fade-in animation */
    @keyframes fadeIn { from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:none;} }
    .fade-in { animation: fadeIn 0.6s ease-out forwards; }

    /* Hidden helper class */
    .visually-hidden { display:none; }

    /* Chat bubble styling */
    .chat-bubble {
      border-radius: 18px; /* Rounded bubbles */
      padding: 10px 15px; /* Padding inside bubbles */
      max-width: 80%; /* Max width to prevent full width */
      margin-bottom: 10px; /* Spacing between bubbles */
      word-wrap: break-word; /* Ensure long words break */
    }
    .user-bubble {
      background-color: #E9F3FF; /* Light blue for user */
      margin-left: auto; /* Align to the right */
      border-bottom-right-radius: 4px; /* Slightly less round corner */
    }
    .assistant-bubble {
      background-color: #F2F2F7; /* Light gray for assistant */
      margin-right: auto; /* Align to the left */
      border-bottom-left-radius: 4px; /* Slightly less round corner */
    }

    /* Focus states for better accessibility */
    button:focus, input:focus, a:focus, iframe:focus, textarea:focus { /* Added textarea */
      outline: 2px solid #8B5CF6; /* Purple outline */
      outline-offset: 2px;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3); /* Optional softer glow */
    }
    /* Remove default iframe border if focused */
    iframe:focus {
        border: none;
    }


    /* Loading spinner animation */
    .spinner {
      border: 3px solid rgba(255,255,255,0.3); /* Light border */
      border-radius: 50%; /* Circle */
      border-top: 3px solid #8B5CF6; /* Purple top border for spin effect */
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-right: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Mobile responsiveness for Navigation */
    @media (max-width: 640px) {
      .mobile-menu {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: white;
        z-index: 100; /* Ensure it's above other content */
        padding: 2rem;
        transform: translateX(-100%); /* Start off-screen */
        transition: transform 0.3s ease;
        display: flex; /* Use flex for layout */
        flex-direction: column; /* Stack items vertically */
      }

      .mobile-menu.open {
        transform: translateX(0); /* Slide in */
      }

      .desktop-nav {
        display: none; /* Hide desktop nav on small screens */
      }

      .mobile-nav-button {
        display: block; /* Show mobile button */
      }
    }

    @media (min-width: 641px) {
      .mobile-nav-button {
        display: none; /* Hide mobile button on large screens */
      }

      .mobile-menu {
        display: none; /* Hide mobile menu */
      }

      .desktop-nav {
        display: flex; /* Show desktop nav */
      }
    }

    /* Styles from subscribe.html */
    .plan-card {
      transition: all 0.3s ease;
    }
    .plan-card:hover {
      transform: translateY(-8px);
    }
    .popular-badge {
      position: absolute;
      top: -12px;
      right: 20px;
      background: linear-gradient(to right, #9333ea, #ec4899);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .gradient-border {
      position: relative;
      border-radius: 1rem;
      background: linear-gradient(white, white) padding-box,
                  linear-gradient(to right, #9333ea, #ec4899) border-box;
      border: 2px solid transparent;
    }

    /* Styles from share.html */
    .share-button{transition:all .3s ease}
    .share-button:hover{transform:translateY(-3px)}
    .gradient-card{background:linear-gradient(white,white) padding-box,
                    linear-gradient(to right,#9333ea,#ec4899) border-box;border:2px solid transparent;border-radius:1rem}
    .gradient-bg{background:linear-gradient(135deg,rgba(147,51,234,.08),rgba(236,72,153,.08))}
    .disabled{opacity:.5;cursor:not-allowed !important;transform:none !important}

  </style>

</head>

<body class="text-gray-900 antialiased"> <div id="authModal" class="fixed inset-0 z-[110] flex items-center justify-center bg-black bg-opacity-50 p-4">
  <div class="bg-white rounded-3xl shadow-2xl p-6 sm:p-8 max-w-md w-full fade-in">
    <div class="flex justify-center mb-6">
      <div class="bg-gradient-to-r from-izzy-pink-500 to-izzy-purple-500 rounded-full w-16 h-16 flex items-center justify-center">
        <span class="text-white text-2xl font-bold">IZZY</span>
      </div>
    </div>
    <div class="text-center mb-8">
      <h1 class="text-2xl sm:text-3xl font-semibold text-gray-900">Real Conversations.</h1>
      <h2 class="text-2xl sm:text-3xl font-semibold text-gray-900 mb-4">Real Confidence.</h2>
      <p class="text-gray-600">Sign up or log in with your email to continue.</p>
    </div>

    <form id="email-form">
      <label for="email" class="sr-only">Email address</label>
      <input type="email" id="email" placeholder="Enter your email"
             aria-label="Email address"
             class="w-full px-4 py-3 rounded-full border border-gray-300 focus:ring-2 focus:ring-izzy-purple-500 mb-3"
             required />
      <button type="submit" id="email-submit-btn"
        class="w-full py-3 rounded-full text-white font-semibold bg-gradient-to-r from-izzy-purple-500 to-izzy-pink-500 hover:from-izzy-purple-600 hover:to-izzy-pink-600 transition-all duration-300 flex items-center justify-center">
        <span class="email-btn-text">Send Magic Link</span>
        <span class="spinner hidden ml-2"></span>
      </button>
    </form>
    
    <!-- Email verification form (hidden by default) -->
    <div id="verification-form-container" class="hidden">
      <div class="text-center mb-4">
        <p class="font-medium">Please enter the email address you used to request the magic link:</p>
      </div>
      <input type="email" id="verification-email" placeholder="Your email address"
             class="w-full px-4 py-3 rounded-full border border-gray-300 focus:ring-2 focus:ring-izzy-purple-500 mb-3" />
      <button id="verify-link-btn"
        class="w-full py-3 rounded-full text-white font-semibold bg-gradient-to-r from-izzy-purple-500 to-izzy-pink-500 hover:from-izzy-purple-600 hover:to-izzy-pink-600 transition-all duration-300 flex items-center justify-center">
        <span id="verify-link-text">Complete Sign-In</span>
        <span id="verify-link-spinner" class="hidden ml-2 spinner"></span>
      </button>
    </div>

    <div id="auth-status-message" class="text-center text-sm mt-3 min-h-[1.2em]"></div>

    <p class="text-center text-xs text-gray-500 mt-4">
      By continuing, you agree to our
      <a href="#terms" class="text-izzy-purple-500 hover:underline">Terms</a> & 
      <a href="#privacy" class="text-izzy-purple-500 hover:underline">Privacy</a>.
    </p>
  </div>
</div>

<div id="subscribeModal" class="fixed inset-0 z-[110] flex items-center justify-center bg-black bg-opacity-50 hidden p-4"> <div class="bg-white rounded-3xl shadow-2xl p-6 sm:p-8 max-w-md w-full fade-in relative"> <button onclick="closeSubscribeModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800" aria-label="Close subscription modal">
        <i class="fas fa-times text-xl"></i>
    </button>

    <div class="flex justify-center mb-6">
      <div class="bg-gradient-to-r from-izzy-pink-500 to-izzy-purple-500 rounded-full w-16 h-16 flex items-center justify-center">
        <span class="text-white text-2xl font-bold">IZZY</span>
      </div>
    </div>

    <h2 class="text-xl sm:text-2xl font-bold text-center mb-4">Upgrade Your Experience</h2> <p class="text-center text-gray-600 mb-6">You've used all your free prompts. Subscribe now to get unlimited conversations with IZZY!</p>

    <div class="space-y-4 mb-6">
      <div class="border border-izzy-purple-200 p-4 rounded-lg hover:bg-purple-50 cursor-pointer transition-colors duration-200">
        <div class="flex justify-between items-center"> <h3 class="font-bold text-lg">Monthly</h3> <span class="font-bold text-lg">$20/mo</span> </div>
        <p class="text-sm text-gray-500 mt-1">Cancel anytime</p>
      </div>

      <div class="border-2 border-izzy-purple-500 p-4 rounded-lg bg-purple-50 cursor-pointer relative"> <span class="absolute -top-3 right-4 inline-block bg-izzy-purple-600 text-white text-xs px-2 py-1 rounded-full font-semibold">BEST VALUE</span> <div class="flex justify-between items-center">
          <h3 class="font-bold text-lg">Annual</h3>
          <span class="font-bold text-lg">$16.67/mo</span> </div>
        <p class="text-sm text-gray-500 mt-1">Save $40 - billed annually ($200)</p>
      </div>
    </div>

    <a href="#subscribe" onclick="closeSubscribeModal()" class="block w-full py-3 rounded-full text-white font-semibold bg-gradient-to-r from-izzy-purple-500 to-izzy-pink-500 hover:from-izzy-purple-600 hover:to-izzy-pink-600 text-center transition-all duration-300">
      View Plans
    </a>

    <button onclick="closeSubscribeModal()" class="block w-full text-gray-500 mt-4 hover:underline">
      Maybe Later
    </button>
  </div>
</div>

<div id="shareModal" class="fixed inset-0 z-[110] flex items-center justify-center bg-black bg-opacity-50 hidden p-4"> <div class="bg-white p-6 rounded-2xl max-w-sm w-full text-center relative fade-in"> <button onclick="closeShareModal()" class="absolute top-3 right-3 text-gray-400 hover:text-gray-700" aria-label="Close share modal">
        <i class="fas fa-times text-lg"></i>
    </button>

    <h2 class="text-2xl font-bold text-izzy-blue mb-4">Your Personal Link</h2>
    <p class="text-sm text-gray-500 mb-2">Tap link to copy</p>

<input  id="personalLink"
        type="text"
        readonly
        onclick="copyReferralLink()"
        class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm mb-4
               text-gray-700 select-all cursor-pointer bg-gray-50"
        title="Click to copy link">

<p class="text-sm text-gray-500 mb-4">Or share via:</p>


    <div class="space-y-3">
      <button onclick="shareVia('whatsapp')"  class="share-button w-full py-2 rounded-lg bg-green-500  text-white font-semibold flex items-center justify-center gap-2">
        <i class="fab fa-whatsapp"></i>WhatsApp
      </button>
      <button onclick="shareVia('email')"    class="share-button w-full py-2 rounded-lg bg-blue-500   text-white font-semibold flex items-center justify-center gap-2">
        <i class="fas fa-envelope"></i>Email
      </button>
      <button onclick="shareVia('facebook')"  class="share-button w-full py-2 rounded-lg bg-blue-700   text-white font-semibold flex items-center justify-center gap-2">
        <i class="fab fa-facebook-f"></i>Facebook
      </button>
      <button onclick="shareVia('twitter')"  class="share-button w-full py-2 rounded-lg bg-sky-500    text-white font-semibold flex items-center justify-center gap-2">
        <i class="fab fa-twitter"></i>X / Twitter
      </button>
      <button onclick="shareVia('reddit')"    class="share-button w-full py-2 rounded-lg bg-orange-600 text-white font-semibold flex items-center justify-center gap-2">
        <i class="fab fa-reddit-alien"></i>Reddit
      </button>
    </div>
  </div>
</div>


<div id="recaptcha-container" style="display: none;"></div>

<button id="mobile-menu-button" class="mobile-nav-button fixed top-4 left-4 z-[101] bg-white rounded-full p-2 shadow-md" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-menu">
</button>

<div id="mobile-menu" class="mobile-menu">
  <div class="flex justify-end mb-8">
    <button id="close-mobile-menu" aria-label="Close menu">
      <i class="fas fa-times text-izzy-blue text-2xl"></i> </button>
  </div>
  <nav class="flex flex-col space-y-6 text-center"> <a href="#about" class="text-izzy-blue font-semibold text-lg hover:text-izzy-purple-600 mobile-menu-link">About</a>
    <a href="#practice" class="text-izzy-blue font-semibold text-lg hover:text-izzy-purple-600 mobile-menu-link">Practice</a>
    <a href="#subscribe" class="text-izzy-blue font-semibold text-lg hover:text-izzy-purple-600 mobile-menu-link">Subscribe</a> <a href="#share" class="text-izzy-blue font-semibold text-lg hover:text-izzy-purple-600 mobile-menu-link">Share</a> <hr class="border-gray-200 my-4"> <button id="mobile-logoutButton" class="text-red-500 font-semibold text-lg hover:text-red-700 hidden mobile-menu-link">Logout</button>
  </nav>
</div>

<nav class="fixed top-0 left-0 w-full bg-white shadow-md z-40 px-6 py-4 desktop-nav items-center"> 
  <a href="#" onclick="copyReferralLink()"
  class="text-2xl font-bold text-izzy-blue mr-8">IZZY</a>
  <div class="flex items-center space-x-6">
    <a href="#about" class="text-izzy-blue font-semibold hover:text-izzy-purple-600 transition-colors">About</a>
    <a href="#practice" class="text-izzy-blue font-semibold hover:text-izzy-purple-600 transition-colors">Practice</a>
    <a href="#subscribe" class="text-izzy-blue font-semibold hover:text-izzy-purple-600 transition-colors">Subscribe</a> <a href="#share" class="text-izzy-blue font-semibold hover:text-izzy-purple-600 transition-colors">Share</a> </div>
  <div class="ml-auto flex items-center space-x-4">
    <button id="logoutButton" class="text-red-500 font-semibold hover:text-red-700 hidden transition-colors">Logout</button>
  </div>
</nav>

<main id="mainContent" class="pt-24 sm:pt-32 flex flex-col items-center px-4 sm:px-6 pb-20 transition-filter duration-300">

  <section id="hero" class="text-center max-w-4xl mb-12 fade-in"> <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold bg-gradient-to-r from-izzy-purple-600 to-izzy-pink-600 bg-clip-text text-transparent leading-tight mb-4">
      The World's First <br/> AI-Avatar for Real Life
    </h1>
    <p class="text-lg text-gray-700 mb-8 max-w-2xl mx-auto"> Practice conversations, build confidence, and never be afraid to approach someone again.<br/>Try it for free (after login).
    </p>

    <div class="w-full max-w-xl mx-auto relative mb-10" style="padding-bottom: 75%;"> <iframe id="avatarFrame"
        class="absolute top-0 left-0 w-full h-full rounded-3xl shadow-lg border border-purple-200"
        allow="microphone; autoplay"
        loading="lazy"
        title="IZZY AI Avatar" src="https://studio.d-id.com/share?id=74b55d9015a0b211877183414aae362e&utm_source=copy">
      </iframe>
    </div>
  </section>

  <section id="practice" class="glass max-w-xl w-full text-center fade-in mb-6" style="animation-delay:.2s">
    <label for="userInput" class="block text-lg font-semibold mb-3">Say something to IZZY:</label>
    <div class="relative">
        <label for="userInput" class="sr-only">Your message to IZZY</label> <!-- Add this -->
        <textarea id="userInput" rows="3" maxlength="400" placeholder="Type or speak your message here… (max 400 chars)"
              aria-label="Your message to IZZY"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-2 resize-none focus:ring-2 focus:ring-izzy-purple-500 focus:border-transparent pr-10" ></textarea>
        <button id="micButton" onclick="startDictation()" class="absolute right-3 top-3 text-gray-500 hover:text-巴巴-purple-600" aria-label="Use voice input">
            <i class="fas fa-microphone text-xl"></i>
        </button>

  <!-- ▲  NEW BLOCK ENDS HERE ▲ -->

  <div class="flex flex-col sm:flex-row justify-center items-center gap-3">
    <!-- send / restart buttons -->
  </div>

    <div class="flex flex-col sm:flex-row justify-center items-center gap-3">
        <button id="sendButton"
                class="w-full sm:w-auto bg-gradient-to-r from-izzy-purple-600 to-izzy-pink-500 text-white px-8 py-3 rounded-full shadow hover:from-izzy-purple-700 hover:to-izzy-pink-600 transition-all duration-300 flex items-center justify-center">
          <span class="send-btn-text">Send Message</span>
          <span class="spinner hidden ml-2"></span>
        </button>
        <button id="restartBtn"
                class="w-full sm:w-auto hidden bg-gray-200 text-gray-800 px-6 py-3 rounded-full hover:bg-gray-300 transition-colors">
          Restart Conversation
        </button>
    </div>

    <!-- …existing textarea + buttons … -->

<div id="prompts-warning"
class="text-sm text-orange-600 mt-3 hidden">
<strong>Note:</strong> You have
<span id="prompts-warning-count">0</span> free prompts left.
<a href="#subscribe"
class="underline text-izzy-purple-600">Subscribe</a> for unlimited.
</div>

</section>

  <section id="conversation-history" class="glass max-w-xl w-full mt-6 hidden fade-in" style="animation-delay:.3s">
    <h3 class="font-semibold text-lg mb-3 text-center">Conversation History</h3>
    <div id="chat-container" class="max-h-64 overflow-y-auto space-y-3 p-1"> </div>
  </section>


  <div id="stats" class="mt-10 w-full max-w-xl fade-in" style="animation-delay:.4s"> <h3 class="text-xl font-semibold mb-4 text-center">Your Progress</h3>
    <div class="grid grid-cols-3 gap-4 text-center bg-gray-50 p-4 rounded-lg">
      <div>
        <div id="conversation-count" class="text-2xl font-bold text-izzy-purple-600">0</div>
        <div class="text-sm text-gray-500">Conversations</div>
      </div>
      <div>
        <div id="skill-level" class="text-2xl font-bold text-izzy-purple-600">Beginner</div>
        <div class="text-sm text-gray-500">Level</div>
      </div>
      <div>
        <div id="prompts-left" class="text-2xl font-bold text-izzy-purple-600">3</div>
        <div class="text-sm text-gray-500">Free Prompts</div>
      </div>
    </div>
  </div>

  <section id="about" class="max-w-3xl mt-16 sm:mt-20 px-4 sm:px-8 text-center text-gray-800 fade-in" style="animation-delay:.5s">
    <h2 class="text-3xl font-bold text-izzy-purple-700 mb-3">IZZY Was Built For You!</h2>
    <p class="text-lg italic font-semibold text-izzy-purple-600 mb-5">Stop texting. Stop hiding behind a screen.</p>
    <p class="text-lg leading-relaxed">
      IZZY isn't just another dating app – it's your personal conversation coach. Practice approaching and talking to women in realistic scenarios, guided by AI.
    </p>
    <p class="mt-4 text-lg leading-relaxed">
       Our upcoming full version will let you personalize IZZY to simulate specific situations and personalities. Help us empower more men to build real confidence!
    </p>
     <a href="#share" class="inline-block mt-6 bg-gradient-to-r from-izzy-purple-500 to-izzy-pink-500 text-white px-6 py-3 rounded-full shadow hover:from-izzy-purple-600 hover:to-izzy-pink-600 transition-all duration-300">
        Share IZZY & Earn Rewards
    </a>
  </section>

  <section id="subscribe" class="w-full mt-16 sm:mt-20 fade-in" style="animation-delay: 0.6s;">
    <div class="text-center mb-12">
      <div class="flex justify-center mb-6">
        <div class="bg-gradient-to-r from-pink-500 to-purple-500 rounded-full w-16 h-16 flex items-center justify-center">
          <span class="text-white text-2xl font-bold">IZZY</span>
        </div>
      </div>
      <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">Choose Your Plan</h1>
      <p class="text-lg text-gray-600 mt-4">Select the subscription that fits your needs</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 w-full max-w-5xl mx-auto">
      <div class="plan-card bg-white rounded-3xl shadow-xl overflow-hidden">
        <div class="bg-gradient-to-r from-purple-100 to-pink-100 p-6">
          <h2 class="text-2xl font-semibold text-gray-800">One Month</h2>
          <div class="mt-4 flex items-end">
            <span class="text-4xl font-bold text-purple-700">$30</span>
            <span class="text-lg text-gray-600 ml-2">/ one-time</span>
          </div>
        </div>
        <div class="p-6">
          <ul class="space-y-4 mb-8">
            <li class="flex items-center">
              <span class="bg-purple-100 rounded-full p-1 mr-3 flex-shrink-0"><i class="fas fa-check text-purple-600 text-xs"></i></span>
              <span>Unlimited prompts</span>
            </li>
            <li class="flex items-center">
              <span class="bg-purple-100 rounded-full p-1 mr-3 flex-shrink-0"><i class="fas fa-check text-purple-600 text-xs"></i></span>
              <span>Personalized Avatar</span>
            </li>
            <li class="flex items-center">
              <span class="bg-purple-100 rounded-full p-1 mr-3 flex-shrink-0"><i class="fas fa-check text-purple-600 text-xs"></i></span>
              <span>Basic Conversational Training</span>
            </li>
          </ul>
          <a href="https://buy.stripe.com/test_PLACEHOLDER_1" target="_blank" class="block text-center bg-white border-2 border-purple-500 text-purple-600 font-semibold py-3 px-6 rounded-full hover:bg-purple-50 transition duration-300">
            Subscribe
          </a>
        </div>
      </div>

      <div class="plan-card gradient-border bg-white rounded-3xl shadow-xl overflow-hidden relative transform md:scale-105"> <div class="popular-badge">Most Popular</div>
        <div class="bg-gradient-to-r from-purple-600 to-pink-500 p-6 text-white">
          <h2 class="text-2xl font-semibold">Monthly</h2>
          <div class="mt-4 flex items-end">
            <span class="text-4xl font-bold">$20</span>
            <span class="text-lg ml-2">/ month</span>
          </div>
        </div>
        <div class="p-6">
          <ul class="space-y-4 mb-8">
            <li class="flex items-center">
              <span class="bg-purple-100 rounded-full p-1 mr-3 flex-shrink-0"><i class="fas fa-check text-purple-600 text-xs"></i></span>
              <span>Unlimited prompts</span>
            </li>
            <li class="flex items-center">
              <span class="bg-purple-100 rounded-full p-1 mr-3 flex-shrink-0"><i class="fas fa-check text-purple-600 text-xs"></i></span>
              <span>Personalized Avatar</span>
            </li>
            <li class="flex items-center">
              <span class="bg-purple-100 rounded-full p-1 mr-3 flex-shrink-0"><i class="fas fa-check text-purple-600 text-xs"></i></span>
              <span>Advanced Conversational Training</span>
            </li>
            <li class="flex items-center">
              <span class="bg-purple-100 rounded-full p-1 mr-3 flex-shrink-0"><i class="fas fa-check text-purple-600 text-xs"></i></span>
              <span>Cancel anytime</span>
            </li>
          </ul>
          <a href="https://buy.stripe.com/test_dR6aHO9PM10AcR60oo" target="_blank" class="block text-center bg-gradient-to-r from-purple-600 to-pink-500 text-white font-semibold py-3 px-6 rounded-full hover:from-purple-700 hover:to-pink-600 transition duration-300">
            Subscribe Now
          </a>
        </div>
      </div>

      <div class="plan-card bg-white rounded-3xl shadow-xl overflow-hidden">
        <div class="bg-gradient-to-r from-purple-100 to-pink-100 p-6">
          <h2 class="text-2xl font-semibold text-gray-800">Annual</h2>
          <div class="mt-4 flex items-end">
            <span class="text-4xl font-bold text-purple-700">$200</span>
            <span class="text-lg text-gray-600 ml-2">/ year</span>
          </div>
          <span class="inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded mt-2">Save $40</span>
        </div>
        <div class="p-6">
          <ul class="space-y-4 mb-8">
            <li class="flex items-center">
              <span class="bg-purple-100 rounded-full p-1 mr-3 flex-shrink-0"><i class="fas fa-check text-purple-600 text-xs"></i></span>
              <span>Unlimited prompts</span>
            </li>
            <li class="flex items-center">
              <span class="bg-purple-100 rounded-full p-1 mr-3 flex-shrink-0"><i class="fas fa-check text-purple-600 text-xs"></i></span>
              <span>Personalized Avatar</span>
            </li>
            <li class="flex items-center">
             <span class="bg-purple-100 rounded-full p-1 mr-3 flex-shrink-0"><i class="fas fa-check text-purple-600 text-xs"></i></span>
              <span>Premium Conversational Training</span>
            </li>
            <li class="flex items-center">
              <span class="bg-purple-100 rounded-full p-1 mr-3 flex-shrink-0"><i class="fas fa-check text-purple-600 text-xs"></i></span>
              <span>Priority Support</span>
            </li>
          </ul>
           <a href="https://buy.stripe.com/test_6oE3cO9PM2h66qU4gg" target="_blank" class="block text-center bg-white border-2 border-purple-500 text-purple-600 font-semibold py-3 px-6 rounded-full hover:bg-purple-50 transition duration-300">
            Subscribe
          </a>
        </div>
      </div>
    </div>

    <div class="mt-12 text-center max-w-2xl mx-auto">
      <h3 class="text-xl font-semibold text-gray-700 mb-4">Why Subscribe to IZZY?</h3>
      <p class="text-gray-600 mb-6">
        IZZY is not a dating app or a flirting asistant. Izzy helps you develop real confidence by providing a safe space to practice conversing with women. No more anxiety, no more awkward silences - just genuine communication skills you can use in real life.
      </p>
      <div class="flex flex-wrap justify-center gap-4 mt-8">
        <div class="bg-gray-50 px-4 py-2 rounded-full text-gray-600 flex items-center text-sm">
          <i class="fas fa-shield-alt w-5 h-5 mr-2 text-purple-500"></i> 100% Safe Practice
        </div>
        <div class="bg-gray-50 px-4 py-2 rounded-full text-gray-600 flex items-center text-sm">
          <i class="fas fa-comments w-5 h-5 mr-2 text-purple-500"></i> Realistic Interactions
        </div>
        <div class="bg-gray-50 px-4 py-2 rounded-full text-gray-600 flex items-center text-sm">
          <i class="fas fa-clock w-5 h-5 mr-2 text-purple-500"></i> 24/7 Availability
        </div>
      </div>
    </div>
  </section>

  <section id="share" class="w-full mt-16 sm:mt-20 fade-in" style="animation-delay: 0.7s;">
    <header class="text-center">
      <div class="flex justify-center mb-6">
        <div class="bg-gradient-to-r from-pink-500 to-purple-500 rounded-full w-16 h-16 flex items-center justify-center">
          <span class="text-white text-2xl font-bold">IZZY</span>
        </div>
      </div>
      <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">Share IZZY</h1>
      <p class="text-lg text-gray-600 mt-4">Help friends discover real confidence with women</p>
      <p id="rewardsText" class="text-md text-purple-700 mt-2 font-semibold">Log in to start sharing & earn free prompts!</p>
    </header>

    <div class="max-w-4xl w-full gradient-bg rounded-3xl p-8 mx-auto mt-12">
      <div class="flex flex-col md:flex-row items-center">
        <div class="w-full md:w-1/2 mb-8 md:mb-0 md:pr-8">
          <img src="https://placehold.co/600x400/E9D5FF/6D28D9?text=IZZY+In+Action" alt="IZZY demo showing conversation practice" class="rounded-2xl shadow-lg w-full">
        </div>
        <div class="w-full md:w-1/2">
          <h2 class="text-2xl font-bold text-purple-700 mb-4">Why Share IZZY?</h2>
          <p class="text-gray-700 mb-6">
            IZZY lets you practice genuine conversations without fear. If you know a friend who could use it, and it may be valuable to him, share your link and both of you benefit free prompts!
          </p>
          <div class="gradient-card p-4">
            <p class="text-gray-800 font-medium">
                "I always got stressed out before talking to a woman and never even thought about approaching them. But IZZY helped me practice, preparing me for any awkward silences or moments, and now I'm much more confident! Thank you!"
            </p>
            <p class="text-right text-sm text-gray-500 mt-2">– Michael T.</p>
        </div>
        </div>
      </div>
    </div>

    <div class="max-w-4xl w-full mx-auto mt-16">
      <h2 class="text-2xl font-bold text-center text-purple-700 mb-8">Your Referral Progress</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center">
          <h3 class="text-lg font-semibold mb-2">Refer 1 friend</h3>
          <p class="text-2xl font-bold text-izzy-purple-600 mb-4">+5 free prompts</p>
          <button id="btnTier1" onclick="openShareModal()"
            class="share-button bg-gradient-to-r from-purple-600 to-pink-500 text-white font-medium py-2 px-6 rounded-full w-full">
            Share Now
          </button>
        </div>
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center">
          <h3 class="text-lg font-semibold mb-2">Refer 2 friends</h3>
          <p class="text-2xl font-bold text-izzy-purple-600 mb-4">+10 free prompts</p>
          <button id="btnTier2" onclick="openShareModal()"
            class="share-button bg-gradient-to-r from-purple-600 to-pink-500 text-white font-medium py-2 px-6 rounded-full w-full">
            Share More
          </button>
        </div>
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center">
          <h3 class="text-lg font-semibold mb-2">Refer 3 friends</h3>
          <p class="text-2xl font-bold text-izzy-purple-600 mb-4">+20 free prompts</p>
          <button id="btnTier3" onclick="openShareModal()"
            class="share-button bg-gradient-to-r from-purple-600 to-pink-500 text-white font-medium py-2 px-6 rounded-full w-full">
            Unlock Max Rewards
          </button>
        </div>
      </div>
       <p id="referralStatus" class="text-center text-gray-600 mt-6"></p> </div>
  </section>

  <section id="terms" class="max-w-3xl mt-16 sm:mt-20 px-4 sm:px-8 text-gray-800 fade-in">
    <h2 class="text-3xl font-bold text-izzy-purple-700 mb-3">Terms of Service</h2>
    <p class="text-lg leading-relaxed">
        Welcome to IZZY! By using our service, you agree to the following terms...
        <!-- Add your full Terms of Service here -->
    </p>
</section>
<section id="privacy" class="max-w-3xl mt-16 sm:mt-20 px-4 sm:px-8 text-gray-800 fade-in">
    <h2 class="text-3xl font-bold text-izzy-purple-700 mb-3">Privacy Policy</h2>
    <p class="text-lg leading-relaxed">
        At IZZY, we value your privacy. This Privacy Policy explains how we collect, use, and protect your data...
        <!-- Add your full Privacy Policy here -->
    </p>
</section>

</main>

<footer class="bg-gradient-to-r from-purple-600 to-pink-500 text-white py-6 px-6 mt-20 fade-in" style="animation-delay: 0.8s;">
  <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center">
    <div class="text-center md:text-left mb-4 md:mb-0">
      <div class="text-2xl font-bold mb-1">IZZY</div>
      <p class="text-sm opacity-80">AI Avatar for Real Conversations</p>
    </div>
    <div class="flex space-x-4">
      <button onclick="shareVia('facebook')" class="bg-blue-600 text-white px-4 py-2 rounded">Facebook</button>
      <button onclick="shareVia('twitter')" class="bg-sky-500 text-white px-4 py-2 rounded">Twitter</button>
      <button onclick="shareVia('whatsapp')" class="bg-green-500 text-white px-4 py-2 rounded">WhatsApp</button>
      <button onclick="shareVia('linkedin')" class="bg-blue-800 text-white px-4 py-2 rounded">LinkedIn</button>
      <button onclick="shareVia('email')" class="bg-gray-600 text-white px-4 py-2 rounded">Email</button>
    </div>
  </div>
</footer>


<div id="toast" class="fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg transform translate-y-full opacity-0 transition-all duration-300 z-[120]"> </div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<script>
// Define reCAPTCHA handler globally
window.recaptchaLoaded = false;
window.onRecaptchaLoad = function () {
  console.log("reCAPTCHA script loaded");
  window.recaptchaLoaded = true;
  setupRecaptcha();
};

// Firebase configuration for izzy-auth
const firebaseConfig = {
  apiKey: "AIzaSyBlmM-6P2WHj59R5FAvFy6ZjIDA637f7p4",
  authDomain: "izzy-auth.firebaseapp.com",
  databaseURL: "https://izzy-auth-default-rtdb.firebaseio.com",
  projectId: "izzy-auth",
  storageBucket: "izzy-auth.firebasestorage.app",
  messagingSenderId: "573135779043",
  appId: "1:573135779043:web:f6c59473f9956c917041d6",
  measurementId: "G-8JLKB2MMKS"
};

// DOM Elements
let domElements = {};
const ACTION_CODE_SETTINGS = {
  url: window.location.origin + window.location.pathname,
  handleCodeInApp: true
};

// Initialize everything on DOM load
document.addEventListener('DOMContentLoaded', () => {
  console.log("Document ready, initializing application...");
  
  // Initialize Firebase
  initializeFirebase();
  
  // Initialize DOM elements
  initializeDOMElements();
  
  // Set up event listeners
  setupEventListeners();
  
  // Handle magic link sign-in
  handleMagicLinkSignIn();
  
  // Set up reCAPTCHA retry logic
  let recaptchaAttempts = 0;
  const maxRecaptchaAttempts = 3;
  const recaptchaLoadTimeout = setTimeout(() => {
    if (!window.recaptchaLoaded && recaptchaAttempts < maxRecaptchaAttempts) {
      console.warn(`reCAPTCHA attempt ${recaptchaAttempts + 1} failed to load. Retrying...`);
      recaptchaAttempts++;
      const script = document.createElement('script');
      script.src = 'https://www.google.com/recaptcha/api.js?onload=onRecaptchaLoad&render=explicit';
      script.async = true;
      script.defer = true;
      document.head.appendChild(script);
    } else if (!window.recaptchaLoaded) {
      console.error('reCAPTCHA failed to load after multiple attempts');
      showStatusMessage('Failed to load reCAPTCHA. Please refresh the page.', true);
      domElements.emailSubmitBtn.disabled = false;
      domElements.emailButtonText.textContent = 'Send Magic Link';
    }
  }, 10000);
});

// Initialize Firebase
function initializeFirebase() {
  try {
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
      console.log("Firebase initialized successfully");
    }
    window.auth = firebase.auth();
    window.db = firebase.database();
    return true;
  } catch (error) {
    console.error("Firebase initialization error:", error);
    alert("Error initializing application. Please refresh the page or contact support.");
    return false;
  }
}

// Initialize DOM elements
function initializeDOMElements() {
  domElements = {
    authModal: document.getElementById('authModal'),
    emailForm: document.getElementById('email-form'),
    emailInput: document.getElementById('email'),
    emailSubmitBtn: document.getElementById('email-submit-btn'),
    emailButtonText: document.querySelector('.email-btn-text'),
    emailButtonSpinner: document.querySelector('#email-submit-btn .spinner'),
    statusMessage: document.getElementById('auth-status-message'),
    recaptchaContainer: document.getElementById('recaptcha-container'),
    mainContent: document.getElementById('mainContent'),
    userInput: document.getElementById('userInput'),
    sendButton: document.getElementById('sendButton'),
    sendButtonText: document.querySelector('.send-btn-text'),
    sendButtonSpinner: document.querySelector('#sendButton .spinner'),
    chatContainer: document.getElementById('chat-container'),
    conversationHistorySection: document.getElementById('conversation-history'),
    restartBtn: document.getElementById('restartBtn'),
    micButtonIcon: document.querySelector('#micButton i'),
    userProfileSection: document.getElementById('user-profile'),
    userDisplayName: document.getElementById('user-display-name'),
    loginBtn: document.getElementById('login-btn'),
    logoutBtn: document.getElementById('logoutButton'),
    mobileLogoutButton: document.getElementById('mobile-logoutButton'),
    mobileMenuButton: document.getElementById('mobile-menu-button'),
    closeMobileMenuButton: document.getElementById('close-mobile-menu'),
    mobileMenu: document.getElementById('mobile-menu'),
    mobileMenuLinks: document.querySelectorAll('.mobile-menu-link'),
    subscribeModal: document.getElementById('subscribeModal'),
    shareModal: document.getElementById('shareModal'),
    personalLinkInput: document.getElementById('personalLink'),
    shareTierButtons: {
      tier1: document.getElementById('btnTier1'),
      tier2: document.getElementById('btnTier2'),
      tier3: document.getElementById('btnTier3')
    },
    verificationFormContainer: document.getElementById('verification-form-container'),
    verifyLinkBtn: document.getElementById('verify-link-btn'),
    verifyLinkText: document.getElementById('verify-link-text'),
    verifyLinkSpinner: document.getElementById('verify-link-spinner'),
    toast: document.getElementById('toast')
  };
  console.log("DOM elements initialized");
}

// Set up event listeners
function setupEventListeners() {
  if (domElements.emailForm) domElements.emailForm.addEventListener('submit', sendMagicLink);
  if (domElements.logoutButton) domElements.logoutButton.addEventListener('click', logout);
  if (domElements.mobileLogoutButton) domElements.mobileLogoutButton.addEventListener('click', () => {
    logout();
    closeMobileMenu();
  });
  if (domElements.sendButton) domElements.sendButton.addEventListener('click', sendMessage);
  if (domElements.restartBtn) domElements.restartBtn.addEventListener('click', restartConversation);
  if (domElements.userInput) domElements.userInput.addEventListener('keydown', (event) => {
    if (event.key === 'Enter' && !event.shiftKey) {
      event.preventDefault();
      sendMessage();
    }
  });
  if (domElements.micButtonIcon) domElements.micButtonIcon.parentElement.addEventListener('click', startDictation);
  if (domElements.mobileMenuButton) domElements.mobileMenuButton.addEventListener('click', toggleMobileMenu);
  if (domElements.closeMobileMenuButton) domElements.closeMobileMenuButton.addEventListener('click', closeMobileMenu);
  if (domElements.mobileMenuLinks) domElements.mobileMenuLinks.forEach(link => {
    link.addEventListener('click', (e) => {
      if (link.getAttribute('href')?.startsWith('#') || link.tagName === 'BUTTON') {
        closeMobileMenu();
      }
    });
  });
  if (domElements.subscribeModal) domElements.subscribeModal.addEventListener('click', (e) => {
    if (e.target === domElements.subscribeModal) closeSubscribeModal();
  });
  if (domElements.shareModal) domElements.shareModal.addEventListener('click', (e) => {
    if (e.target === domElements.shareModal) closeShareModal();
  });
  if (domElements.personalLinkInput) domElements.personalLinkInput.addEventListener('click', copyReferralLink);
  Object.values(domElements.shareTierButtons).forEach(button => {
    if (button) button.addEventListener('click', openShareModal);
  });
  document.querySelectorAll('#subscribe .plan-card a[target="_blank"]').forEach(button => {
    button.addEventListener('click', (e) => {
      if (!window.currentUser) {
        e.preventDefault();
        showToast("Please log in before subscribing.", true);
      } else {
        console.log("Proceeding to subscription:", button.href);
      }
    });
  });
  console.log("Event listeners set up");
}

// Setup reCAPTCHA
function setupRecaptcha() {
  if (!window.recaptchaLoaded) {
    console.error("reCAPTCHA script not loaded yet");
    showStatusMessage("Failed to load reCAPTCHA. Please refresh.", true);
    domElements.emailSubmitBtn.disabled = false;
    domElements.emailButtonText.textContent = "Send Magic Link";
    return;
  }
  if (window.recaptchaVerifier) {
    window.recaptchaVerifier.clear();
    window.recaptchaVerifier = null;
  }
  try {
    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
      'size': 'invisible',
      'callback': (response) => {
        console.log("reCAPTCHA solved:", response);
      },
      'expired-callback': () => {
        console.log("reCAPTCHA expired");
        window.recaptchaVerifier = null;
        setupRecaptcha();
      }
    });
    window.recaptchaVerifier.render().then(widgetId => {
      console.log("reCAPTCHA rendered, widget ID:", widgetId);
      domElements.emailSubmitBtn.disabled = false;
      domElements.emailButtonText.textContent = "Send Magic Link";
    }).catch(error => {
      console.error("reCAPTCHA render error:", error);
      showStatusMessage("Failed to load reCAPTCHA. Please refresh.", true);
      domElements.emailSubmitBtn.disabled = false;
      domElements.emailButtonText.textContent = "Send Magic Link";
    });
  } catch (error) {
    console.error("Error setting up reCAPTCHA:", error);
    showStatusMessage("Please try again in a moment.", true);
    domElements.emailSubmitBtn.disabled = false;
    domElements.emailButtonText.textContent = "Send Magic Link";
  }
}

// Send magic link
function sendMagicLink(event) {
  event.preventDefault();
  const email = domElements.emailInput.value.trim();
  if (!email) {
    showStatusMessage("Please enter your email address.", true);
    return;
  }
  if (!window.recaptchaVerifier) {
    setupRecaptcha();
  } else {
    sendMagicLinkWithRecaptcha(email);
  }
}

// Send magic link with reCAPTCHA
function sendMagicLinkWithRecaptcha(email) {
  if (!email || !validateEmail(email)) {
    showStatusMessage("Please enter a valid email address.", true);
    return;
  }
  if (!window.auth) {
    console.error("Firebase auth is not initialized");
    showStatusMessage("Authentication service unavailable. Please refresh the page.", true);
    return;
  }
  console.log("Starting magic link process for:", email);
  showButtonLoading(domElements.emailSubmitBtn, domElements.emailButtonText, domElements.emailButtonSpinner, true);
  clearStatusMessage();
  showStatusMessage(`Sending magic link to ${email}...`, false);
  auth.sendSignInLinkToEmail(email, ACTION_CODE_SETTINGS)
    .then(() => {
      console.log("Magic link sent successfully");
      window.localStorage.setItem('emailForSignIn', email);
      showStatusMessage(`
        <div class="success-message">
          <p><strong>Magic link sent!</strong></p>
          <p>We've sent a login link to: <strong>${email}</strong></p>
          <p>Please check both your inbox and spam folder.</p>
          <p>The link will expire in 15 minutes.</p>
        </div>
      `, false);
      domElements.emailInput.value = '';
      showToast("Email sent successfully! Check your inbox.", false);
    })
    .catch((error) => {
      console.error("Error sending magic link:", error);
      let message = "Failed to send magic link. Please try again.";
      if (error.code === 'auth/invalid-email') message = "Invalid email address. Please check and try again.";
      else if (error.code === 'auth/too-many-requests') message = "Too many attempts. Please try again later.";
      else if (error.code === 'auth/missing-continue-uri' || error.code === 'auth/unauthorized-continue-uri') message = "Authentication configuration error. Please contact support.";
      else if (error.code === 'auth/operation-not-allowed') message = "Email sign-in is not enabled. Please contact support.";
      showStatusMessage(message, true);
      console.error(`Auth error (${error.code}):`, error.message);
    })
    .finally(() => {
      showButtonLoading(domElements.emailSubmitBtn, domElements.emailButtonText, domElements.emailButtonSpinner, false);
    });
}

// Handle magic link sign-in
function handleMagicLinkSignIn() {
  if (auth.isSignInWithEmailLink(window.location.href)) {
    let email = window.localStorage.getItem('emailForSignIn');
    if (!email) {
      showEmailVerificationForm();
      return;
    }
    showStatusMessage("Verifying your magic link...", false);
    auth.signInWithEmailLink(email, window.location.href)
      .then((result) => {
        console.log("Signed in with email link successfully.");
        window.localStorage.removeItem('emailForSignIn');
        if (window.history && window.history.replaceState) {
          window.history.replaceState({}, document.title, window.location.pathname);
        }
        domElements.authModal?.classList.add('hidden');
        domElements.mainContent?.classList.remove('blur-background');
        showToast("Welcome to IZZY! You're now signed in.", false);
        updateUIForLoggedInUser(result.user);
      })
      .catch((error) => {
        console.error("Error signing in with email link:", error);
        let message = "Error signing in. Please try again.";
        if (error.code === 'auth/expired-action-code') message = "The sign-in link has expired. Please request a new one.";
        else if (error.code === 'auth/invalid-action-code') message = "Invalid sign-in link. Please request a new one.";
        else if (error.code === 'auth/invalid-email') message = "Invalid email. Please check and try again.";
        else if (error.code === 'auth/user-disabled') message = "This account has been disabled. Please contact support.";
        showStatusMessage(message, true);
        window.localStorage.removeItem('emailForSignIn');
      });
  }
}

// Show email verification form
function showEmailVerificationForm() {
  if (domElements.verificationFormContainer) {
    domElements.verificationFormContainer.classList.remove('hidden');
    const verificationEmailInput = document.getElementById('verification-email');
    if (domElements.verifyLinkBtn) {
      domElements.verifyLinkBtn.addEventListener('click', () => {
        const enteredEmail = verificationEmailInput.value.trim();
        if (validateEmail(enteredEmail)) {
          window.localStorage.setItem('emailForSignIn', enteredEmail);
          handleMagicLinkSignIn();
        } else {
          showStatusMessage("Please enter a valid email address.", true);
        }
      });
    }
  } else {
    showStatusMessage("Please enter your email to verify the link.", true);
  }
}

// Update UI for logged-in user
function updateUIForLoggedInUser(user) {
  window.currentUser = user; // Store user for subscription checks
  if (domElements.userProfileSection) domElements.userProfileSection.classList.remove('hidden');
  if (domElements.loginBtn) domElements.loginBtn.classList.add('hidden');
  if (domElements.logoutBtn) domElements.logoutBtn.classList.remove('hidden');
  if (domElements.userDisplayName && user.email) {
    domElements.userDisplayName.textContent = user.displayName || user.email.split('@')[0];
  }
}

// Share via social media
function shareVia(platform) {
  const shareUrl = 'https://izzy-auth.web.app';
  const shareText = 'Check out IZZY, your AI assistant! #IZZY #AI';
  let url = '';
  switch (platform.toLowerCase()) {
    case 'facebook':
      url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
      break;
    case 'twitter':
      url = `https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareText)}`;
      break;
    case 'whatsapp':
      url = `https://api.whatsapp.com/send?text=${encodeURIComponent(shareText + ' ' + shareUrl)}`;
      break;
    case 'linkedin':
      url = `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(shareUrl)}&title=${encodeURIComponent('IZZY AI Assistant')}&summary=${encodeURIComponent(shareText)}`;
      break;
    case 'email':
      url = `mailto:?subject=${encodeURIComponent('Discover IZZY AI')}&body=${encodeURIComponent(shareText + ' ' + shareUrl)}`;
      break;
    case 'reddit':
      url = `https://www.reddit.com/submit?url=${encodeURIComponent(shareUrl)}&title=${encodeURIComponent(shareText)}`;
      break;
    default:
      console.error('Unsupported share platform:', platform);
      showToast('Sharing platform not supported.', true);
      return;
  }
  try {
    window.open(url, '_blank');
    showToast(`Shared on ${platform}!`, false);
  } catch (error) {
    console.error('Error sharing on', platform, ':', error);
    showToast('Failed to share. Please try again.', true);
  }
}

// Send message to IZZY
function sendMessage() {
  const messageText = domElements.userInput.value.trim();
  if (!messageText) {
    showToast('Please enter a message.', true);
    return;
  }
  if (!window.currentUser) {
    showToast('Please log in to send messages.', true);
    return;
  }
  showButtonLoading(domElements.sendButton, domElements.sendButtonText, domElements.sendButtonSpinner, true);
  
  // Add message to UI
  const messageElement = document.createElement('div');
  messageElement.className = 'flex justify-end mb-4';
  messageElement.innerHTML = `
    <div class="bg-izzy-blue text-white p-3 rounded-lg max-w-xs shadow-md">
      ${messageText}
    </div>
  `;
  domElements.chatContainer.appendChild(messageElement);
  domElements.chatContainer.scrollTop = domElements.chatContainer.scrollHeight;
  
  // Save to Firebase
  const userId = window.currentUser.uid;
  const messageRef = window.db.ref(`messages/${userId}`).push();
  messageRef.set({
    text: messageText,
    timestamp: firebase.database.ServerValue.TIMESTAMP
  }).then(() => {
    console.log('Message saved to Firebase');
    domElements.userInput.value = '';
    // Simulate IZZY response (placeholder)
    addIzzyResponse('Thanks for your message! I’m working on a reply...');
  }).catch(error => {
    console.error('Error saving message:', error);
    showToast('Failed to send message.', true);
  }).finally(() => {
    showButtonLoading(domElements.sendButton, domElements.sendButtonText, domElements.sendButtonSpinner, false);
  });
}

// Add IZZY response to chat
function addIzzyResponse(text) {
  const responseElement = document.createElement('div');
  responseElement.className = 'flex justify-start mb-4';
  responseElement.innerHTML = `
    <div class="bg-gray-200 text-gray-800 p-3 rounded-lg max-w-xs shadow-md">
      ${text}
    </div>
  `;
  domElements.chatContainer.appendChild(responseElement);
  domElements.chatContainer.scrollTop = domElements.chatContainer.scrollHeight;
}

// Start dictation
function startDictation() {
  if (!('webkitSpeechRecognition' in window)) {
    showToast('Speech recognition not supported in this browser.', true);
    return;
  }
  const recognition = new webkitSpeechRecognition();
  recognition.lang = 'en-US';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;
  
  domElements.micButtonIcon.classList.remove('fa-microphone');
  domElements.micButtonIcon.classList.add('fa-microphone-slash', 'text-red-500');
  
  recognition.start();
  showToast('Recording... Say something!', false);
  
  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    domElements.userInput.value = transcript;
    showToast('Transcription added to input.', false);
    // Optionally auto-send the message
    sendMessage();
  };
  
  recognition.onend = () => {
    domElements.micButtonIcon.classList.remove('fa-microphone-slash', 'text-red-500');
    domElements.micButtonIcon.classList.add('fa-microphone');
    console.log('Dictation ended');
  };
  
  recognition.onerror = (event) => {
    console.error('Speech recognition error:', event.error);
    showToast('Error during recording. Please try again.', true);
    domElements.micButtonIcon.classList.remove('fa-microphone-slash', 'text-red-500');
    domElements.micButtonIcon.classList.add('fa-microphone');
  };
}

// Copy referral link
function copyReferralLink() {
  if (!domElements.personalLinkInput) return;
  try {
    domElements.personalLinkInput.select();
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(domElements.personalLinkInput.value)
        .then(() => showToast("Link copied to clipboard!", false))
        .catch(() => {
          document.execCommand('copy');
          showToast("Link copied (fallback method)!", false);
        });
    } else {
      document.execCommand('copy');
      showToast("Link copied (fallback method)!", false);
    }
  } catch (err) {
    console.error('Failed to copy link:', err);
    showToast("Could not copy link.", true);
  }
  window.getSelection()?.removeAllRanges();
}

// Show toast notification
function showToast(message, isError = false, duration = 3000) {
  clearTimeout(window.toastTimeout);
  if (!domElements.toast) return;
  domElements.toast.textContent = message;
  domElements.toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg transform transition-all duration-300 z-[120] ${isError ? 'bg-red-600 text-white' : 'bg-gray-800 text-white'}`;
  requestAnimationFrame(() => {
    domElements.toast.classList.remove('translate-y-full', 'opacity-0');
    domElements.toast.classList.add('translate-y-0', 'opacity-100');
  });
  window.toastTimeout = setTimeout(() => {
    domElements.toast.classList.remove('translate-y-0', 'opacity-100');
    domElements.toast.classList.add('translate-y-full', 'opacity-0');
  }, duration);
}

// Validate email
function validateEmail(email) {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(String(email).toLowerCase());
}

// Show status message
function showStatusMessage(message, isError = false) {
  if (!domElements.statusMessage) return;
  domElements.statusMessage.innerHTML = message;
  domElements.statusMessage.classList.remove('hidden');
  domElements.statusMessage.classList.toggle('error-message', isError);
  domElements.statusMessage.classList.toggle('success-message', !isError);
}

// Clear status message
function clearStatusMessage() {
  if (domElements.statusMessage) {
    domElements.statusMessage.innerHTML = '';
    domElements.statusMessage.classList.add('hidden');
  }
}

// Show/hide button loading
function showButtonLoading(button, textElement, spinnerElement, isLoading) {
  if (!button || !textElement || !spinnerElement) return;
  button.disabled = isLoading;
  textElement.classList.toggle('opacity-50', isLoading);
  spinnerElement.classList.toggle('hidden', !isLoading);
}

// Mobile menu logic
function toggleMobileMenu() {
  const isOpen = domElements.mobileMenu.classList.contains('open');
  if (isOpen) closeMobileMenu();
  else openMobileMenu();
}

function openMobileMenu() {
  if (domElements.mobileMenu) domElements.mobileMenu.classList.add('open');
  domElements.mobileMenuButton?.setAttribute('aria-expanded', 'true');
}

function closeMobileMenu() {
  if (domElements.mobileMenu) domElements.mobileMenu.classList.remove('open');
  domElements.mobileMenuButton?.setAttribute('aria-expanded', 'false');
}

function openShareModal() {
  if (domElements.shareModal) domElements.shareModal.classList.remove('hidden');
  domElements.mainContent?.classList.add('blur-background');
}

function closeShareModal() {
  if (domElements.shareModal) domElements.shareModal.classList.add('hidden');
  domElements.mainContent?.classList.remove('blur-background');
}

function openSubscribeModal() {
  if (domElements.subscribeModal) domElements.subscribeModal.classList.remove('hidden');
  domElements.mainContent?.classList.add('blur-background');
}

function closeSubscribeModal() {
  if (domElements.subscribeModal) domElements.subscribeModal.classList.add('hidden');
  domElements.mainContent?.classList.remove('blur-background');
}

// Restart conversation
function restartConversation() {
  if (!window.currentUser) {
    showToast('Please log in to restart the conversation.', true);
    return;
  }
  domElements.chatContainer.innerHTML = '';
  const userId = window.currentUser.uid;
  window.db.ref(`messages/${userId}`).remove()
    .then(() => {
      showToast('Conversation restarted.', false);
    })
    .catch(error => {
      console.error('Error restarting conversation:', error);
      showToast('Failed to restart conversation.', true);
    });
}

// Logout
function logout() {
  auth.signOut().then(() => {
    window.currentUser = null;
    if (domElements.userProfileSection) domElements.userProfileSection.classList.add('hidden');
    if (domElements.loginBtn) domElements.loginBtn.classList.remove('hidden');
    if (domElements.logoutBtn) domElements.logoutBtn.classList.add('hidden');
    domElements.chatContainer.innerHTML = '';
    showToast('Logged out successfully.', false);
  }).catch(error => {
    console.error('Logout error:', error);
    showToast('Failed to log out.', true);
  });
}

// Microphone permission
function requestMicPermission() {
  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return;
  navigator.mediaDevices.getUserMedia({ audio: true })
    .then(stream => {
      stream.getTracks().forEach(t => t.stop());
      console.log("Microphone permission granted");
    })
    .catch(err => {
      console.warn("Mic permission denied:", err);
    });
}
document.addEventListener('DOMContentLoaded', requestMicPermission);
</script>
</body>
</html>